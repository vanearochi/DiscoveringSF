"use Strict";function initMap(){function e(e){var a=String.fromCharCode(65+i),r=e.name,n=new google.maps.Marker({position:t,map:map,icon:{path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#FF1010",fillOpacity:.7,strokeWeight:3,scale:.75,labelOrigin:new google.maps.Point(0,(-25))},title:r,id:i,label:{text:a,fontSize:"18px"},visible:!0});google.maps.event.addListener(n,"click",o),e.marker=n}function o(){markerSelected(this),hideMarkers(this),askInfoToPlacesLibrary(this),selectedStatus(!0)}var a;map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.82,lng:-122.431297},zoom:12}),google.maps.event.addDomListener(window,"resize",function(){var e=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(e),map.setZoom(11)});for(var i=0;i<placesContainer().length;i++){var t=placesContainer()[i].location;e(placesContainer()[i])}askInfoToPlacesLibrary=function(e){function o(o,a){if(e.setAnimation(null),a==google.maps.places.PlacesServiceStatus.OK){var i=o[0],t=i.formatted_address;koAddress(""),koAddress(t)}else a==google.maps.places.PlacesServiceStatus.ZERO_RESULTS?alert("Sorry we could't find any result for your search"):alert("Sorry there was an error.Please see the Javascript console for technical details"+a)}var a=e.title,i=new google.maps.places.PlacesService(map);i.textSearch({query:a},o),e.setAnimation(google.maps.Animation.BOUNCE)},showDirections=function(e){void 0!==a&&void 0!==a.map&&(a.setMap(null),a.setPanel(null));var o=e.coords.latitude,i=e.coords.longitude,t={lat:o,lng:i},r=new google.maps.DirectionsService;a=new google.maps.DirectionsRenderer,a.setMap(map),a.setPanel(document.getElementById("steps"));var n=choosenTravelMode().directionsStr,l={origin:t,destination:markerSelected().position,travelMode:google.maps.TravelMode[n]};r.route(l,function(e,o){o==google.maps.DirectionsStatus.OK?(void 0!==userMarker&&userMarker.setVisible(!1),markerSelected().setVisible(!1),a.setDirections(e),loadingDirections(!1)):o==google.maps.DirectionsStatus.ZERO_RESULTS?(loadingDirections(!1),alert("No route could be found between the origin and destination. Please try another travel mode")):(loadingDirections(!1),alert("Sorry there was an error:"+o))})},hideMarkers=function(e){map.setZoom(15),map.setCenter(e.position);for(var o=0;o<placesContainer().length;o++){var a=placesContainer()[o];a.marker!=e&&a.marker.setVisible(!1)}},showAllMarkers=function(){selectedStatus(!1),map.setZoom(12),map.setCenter({lat:37.82,lng:-122.431297}),void 0!==a&&(a.setMap(null),a.setPanel(null));for(var e=0;e<placesContainer().length;e++){var o=placesContainer()[e];o.marker.setVisible(!0)}},hideOrShowMarker=function(e,o){e.setVisible(o)},showUserLocation=function(e){var o=e.coords.latitude,a=e.coords.longitude,i=new google.maps.LatLng({lat:o,lng:a}),t=new google.maps.LatLng({lat:37.82,lng:-122.431297}),r=new google.maps.LatLngBounds;userMarker=new google.maps.Marker({position:i,icon:{path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#1569C7",fillOpacity:.7,strokeWeight:3,scale:.75,labelOrigin:new google.maps.Point(0,(-25))},visible:!0,zIndex:2}),selectedStatus()===!0?(r.extend(markerSelected().getPosition()),r.extend(i),map.fitBounds(r),userMarker.setMap(map)):(userMarker.setMap(map),r.extend(t),r.extend(i),map.fitBounds(r)),google.maps.event.addListener(map,"idle",function(){map.panBy(0,0)})},ko.applyBindings(new myViewModel)}function errorHandler(){alert("Sorry there was an "+this.event.type+".Please see the Javascript console for technical details")}function myViewModel(){var e,o=this;o.addressVisible=ko.observable(!1),o.infoVisible=ko.observable(!1),o.inputValue=ko.observable(""),o.placeAddress=ko.observable(""),o.wikiInfo=ko.observable(""),o.url=ko.observable(""),o.goToWikiPage=ko.observable("More Info"),o.showMyLocation=ko.observable(!0),o.selectedStatus=ko.observable(!1),o.showOrHideLocation=ko.observable("Show my location"),o.textValue=ko.observable("Show all places"),o.giveWikiInfo=function(o){var a=o.replace(/\s/g,"_");return e=$.ajax({type:"get",url:"https://www.wikipedia.org/w/api.php?action=query&list=search&srsearch="+a+"_California&format=json&callback=wikiCallback",dataType:"jsonp"})},o.passClickInformation=function(){askInfoToPlacesLibrary(this.marker),o.hideTitles(this.marker),markerSelected(this.marker),o.showWikiInfo(this.marker),o.infoVisible(!0),selectedStatus(!0),console.log(choosenTravelMode()),console.log(travelMode())},o.hideTitles=function(e){hideMarkers(e);for(var o=0;o<placesContainer().length;o++)placesContainer()[o].marker!=e&&placesContainer()[o].titleVisible(!1)},o.showAllTitles=function(){loadingDirections===!0&&loadingDirections(!1),showAllMarkers(),o.infoVisible(!1),o.inputValue(""),o.wikiInfo("");for(var e=0;e<placesContainer().length;e++)placesContainer()[e].titleVisible(!0)},markerSelected.subscribe(function(e){o.hideTitles(e),"span"!=event.path[0].localName&&o.showWikiInfo(e)}),o.inputValue.subscribe(function(e){var a=e.trim();selectedStatus()===!0&&(showAllMarkers(),o.infoVisible(!1),selectedStatus(!1));for(var i=0;i<placesContainer().length;i++){var t=placesContainer()[i];a.length>0?t.name.toLowerCase().includes(a.toLowerCase())===!0?(t.titleVisible(!0),hideOrShowMarker(t.marker,!0)):(t.titleVisible(!1),hideOrShowMarker(t.marker,!1)):(t.titleVisible(!0),hideOrShowMarker(t.marker,!0))}}),koAddress.subscribe(function(e){o.infoVisible(!0),o.placeAddress(e)}),o.showWikiInfo=function(a){e=o.giveWikiInfo(a.title),e.done(function(e){if(0===e.query.search.length)alert("Sorry we couldn't find any Wikipedia Information for the place you are looking for");else if(e.query.search.length>0){var i=e.query.search[0].snippet;o.wikiInfo(i);var t="https://en.wikipedia.org/wiki/"+a.title;o.url(t)}}),e.fail(function(e){alert("Sorry there was an problem with your request: "+e.status+" "+e.statusText)})},o.callGoogleDirections=function(){o.getGeolocation(showDirections),o.showOrHideLocation("Show my location"),loadingDirections(!0)},o.getUserLocation=function(){"Show my location"===o.showOrHideLocation()?(loadingCurrentLocation(!0),o.getGeolocation(showUserLocation)):(o.showOrHideLocation("Show my location"),console.log(userMarker),hideOrShowMarker(userMarker,!1))},o.getGeolocation=function(e){function a(a){loadingDirections()===!1&&o.showOrHideLocation("Hide my location"),e(a),loadingCurrentLocation(!1)}function i(e){loadingDirections(!1),loadingCurrentLocation(!1),alert("Sorry there was an error:"+e.code+" "+e.message)}if("geolocation"in navigator){var t=navigator.geolocation;t.getCurrentPosition(a,i)}else loadingDirections(!1),loadingCurrentLocation(!1),alert("Sorry geolocation is not available")}}var map,placesContainer=ko.observable([{name:"Golden Gate Bridge",location:{lat:37.8199286,lng:-122.47825510000001},titleVisible:ko.observable(!0)},{name:"Crissy Field",location:{lat:37.8039,lng:-122.4641},titleVisible:ko.observable(!0)},{name:"Golden Gate Park",location:{lat:37.7694208,lng:-122.48621379999997},titleVisible:ko.observable(!0)},{name:"Fort Point",location:{lat:37.8105931,lng:-122.4771093},titleVisible:ko.observable(!0)},{name:"Mount Davidson",location:{lat:37.73833330000001,lng:-122.4533333},titleVisible:ko.observable(!0)},{name:"San Francisco Ferry Building",location:{lat:37.7955469,lng:-122.39341769999999},titleVisible:ko.observable(!0)},{name:"San Francisco Symphony",location:{lat:37.777629,lng:-122.4906083},titleVisible:ko.observable(!0)},{name:"de Young Museum",location:{lat:37.7714732,lng:-122.4708642},titleVisible:ko.observable(!0)},{name:"Bay Bridge",location:{lat:47.7982799,lng:-122.377777},titleVisible:ko.observable(!0)},{name:"Alcatraz Island",location:{lat:37.8269775,lng:-122.4229555},titleVisible:ko.observable(!0)}]),TravelMode=function(e,o){this.mode=e,this.directionsStr=o},abc=["A ","B ","C ","D ","E ","F ","G ","H ","I ","J "],markerSelected=ko.observable(""),koAddress=ko.observable(""),selectedStatus=ko.observable(!1),askInfoToPlacesLibrary,hideMarkers,showDirections,showAllMarkers,hideOrShowMarker,showUserLocation,userMarker,loadingCurrentLocation=ko.observable(!1),loadingDirections=ko.observable(!1),travelMode=ko.observable([new TravelMode("Car","DRIVING"),new TravelMode("Foot","WALKING"),new TravelMode("Bike","BICYCLING"),new TravelMode("Public Transportation","TRANSIT")]),choosenTravelMode=ko.observable(travelMode()[0]);